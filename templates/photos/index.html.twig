{% extends 'base.html.twig' %}

{% block title %}Photos Index{% endblock %}

{% block body %}
    {% if is_granted ('ROLE_ADMIN') %}
        <div class="row">
            <div class="col-8"></div>
            <div class="col-4">
                <a class="btn btn-outline-primary btn-sm" href="{{ path('photo_locations_index') }}">List locations</a>
                <a class="btn btn-outline-success btn-sm" href="{{ path('photo_locations_new') }}">+</a>
                <a class="btn btn-outline-danger btn-sm" href="{{ path('photos_delete_all') }}">Delete All Photos</a>
            </div>
        </div>
    {% else %}
        <h1 style="color: red">
            {% if is_granted('ROLE_ADMIN') %}
                <a target="_blank" href="{{ path('photo_locations_index') }}">Photo locations</a>
            {% else %}
                Photo locations
            {% endif %}
        </h1>
    {% endif %}

    <div class="mt-1 mb-1">
        {% for location in locations %}
            {% if location.publicPrivate =="Public" %}
                <a class="btn btn-outline-danger btn-sm" target="_blank"
                   href="{{ path('show_photos_by_location', { 'locationName':location.location}) }}">{{ location.location }}</a>
            {% endif %}
            {% if app.user is not null %}
                {% if app.user.id in location.enabledUsers or (is_granted('ROLE_ADMIN') and location.publicPrivate = "Private") %}
                    <a class="btn btn-outline-info btn-sm" target="_blank"
                       href="{{ path('show_photos_by_location', { 'locationName':location.location}) }}">{{ location.location }}</a>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>

    {% if is_granted('ROLE_ADMIN') %}
        <table class="table">
            <thead>
            <tr>
                <th style="width: 50px">Photo</th>
                <th style="width: 50px">Date</th>
                <th style="width: 250px">Location</th>
                <th style="width: 10px; text-align: center">Rotate</th>
                <th style="width: 50px"></th>
                <th style="width: 500px"></th>
            </tr>
            </thead>

            <tbody>
            {% for photo in photos %}
                <tr>
                    {% set loc = asset('photos')~"/"~photo.photoFile %}
                    <td>
                        {% if photo.rotate==1 %}
                            <img height="50" width="50" src="{{ loc }}" class="rounded-circle rotate-90">
                        {% else %}
                            <img height="50" width="50" src="{{ loc }}" class="rounded-circle">
                        {% endif %}
                    </td>
                    <td>{{ photo.location.date|date('d-M-Y') }}</td>
                    <td>{{ photo.location.location }}</td>
                    <td style="text-align: center">
                        {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('rotate_photo',{photoID:photo.id}) }}">
                            {% endif %}
                            {% if photo.rotate==1 %}
                                <i class="fas fa-circle text-success"></i>
                            {% else %}
                                <i class="fas fa-circle text-danger"></i>
                            {% endif %}
                        </a>
                    </td>
                    <td style="width: 100px">
                        {% if is_granted('ROLE_ADMIN') %}
                            <a class="btn btn-outline-danger btn-sm" href="{{ path('photos_edit', {'id': photo.id}) }}">Edit</a>
                            <form class="d-inline" method="post" action="{{ path('photos_delete', {'id': photo.id}) }}"
                                  onsubmit="return confirm('Are you sure you want to delete this item?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ photo.id) }}">
                                <button class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        {% endif %}
                    </td>
                    <td></td>

                </tr>
            {% endfor %}
            </tbody>
        </table>

    {% endif %}

{% endblock %}

{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                'pageLength': 100,
                "order": [[1, 'asc', 2, 'desc']],
                "paging": false,
                "searching": false,
                "bInfo": false
            });
        });
    </script>
{% endblock datatable %}
