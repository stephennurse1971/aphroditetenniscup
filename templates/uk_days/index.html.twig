{% extends 'base.html.twig' %}

{% block title %}UK Days{% endblock %}

{% block body %}
    <h1 style="color: red">Days in UK <a target="_blank" href="{{ path('uk_days_new') }}">+</a></h1>
    <br>

    <table class="table table-responsive">
        <thead>
        <tr>
            <th style="width: 50px">Tax year <a target="_blank" class="btn-outline-secondary btn-sm"
                                                href="{{ path('tax_year_new') }}">+</a>
            <th>From</th>
            <th>To</th>
            {% for country in countries %}
                <th style="width: 50px; text-align: right">{{ country.country }}</th>
            {% endfor %}
            <th><a target="_blank" href="{{ path('country_new') }}">+</a></th>
        </tr>
        </thead>
        <tbody>
        {% for taxyear in taxyears %}
            <tr>
                <td>
                    <b>{{ taxyear.taxYearRange }}</b>
                </td>
                <td>
                    {{ taxyear.startDate|date('d-M-y') }}
                </td>
                <td>
                    {{ taxyear.endDate|date('d-M-y') }}
                </td>
                {% for country in countries %}
                    <td style="text-align: right">
                        {{ TaxYear.daysInTaxYear(taxyear.taxYearRange, country.country )|number_format() }}
                    </td>
                {% endfor %}
                <td></td>
            </tr>
        {% endfor %}


        </tbody>
    </table>
    <hr>

    <table class="table table-responsive">
        <thead>
        <tr>
            <th style="width: 100px">Start Date</th>
            <th style="width: 100px">End Date</th>
            <th style="width: 50px"># days</th>
            <th style="width: 50px">Country</th>
            <th style="width: 50px">Outbound</th>
            <th style="width: 50px">Inbound</th>
            <th>Commentary</th>
            <th style="text-align: right">Period 1</th>
            <th style="text-align: right">Period 1<br>Days</th>
            <th style="text-align: right">Period 2</th>
            <th style="text-align: right">Period 2<br>Days</br> </th>
            <th style="width: 50px">#</th>
        </tr>
        </thead>
        <tbody>
        {% for uk_day in uk_days %}
            <tr>
                <td data-sort="{{ uk_day.startDate ? uk_day.startDate|date('Y-m-d') : '' }}">
                    <a href="{{ path('uk_days_edit', {'id': uk_day.id}) }}">{{ uk_day.startDate ? uk_day.startDate|date('d-M-Y') : '' }}</a>
                </td>
                <td>{{ uk_day.endDate ? uk_day.endDate|date('d-M-Y') : '' }}</td>
                <td style="text-align: left"
                {{ uk_day.dayCount }}</td>
                <td style="text-align: left">{{ uk_day.country.country }}</td>
                <td style="text-align: center">
                    {% for travelDocs in uk_day.travelDocs %}
                        <strong>
                            <a title="{{ travelDocs }}" target="_blank"
                               href="{{ path('to_do_list_viewfile',{fileName:travelDocs}) }}"> <i
                                        class="fas fa-paperclip"></i> </a>
                        </strong>
                        <br>
                    {% endfor %}
                </td>
                <td style="text-align: center">
                    {% for travelDocs2 in uk_day.travelDocs2 %}
                        <strong>
                            <a title="{{ travelDocs2 }}" target="_blank"
                               href="{{ path('to_do_list_viewfile',{fileName:travelDocs2}) }}"> <i
                                        class="fas fa-paperclip"></i></a>
                        </strong>
                        <br>
                    {% endfor %}
                </td>
                <td style="text-align: left">{{ uk_day.comment }}</td>
                <td style="text-align: right">

                    {% set taxyears = TaxYear.findTaxYearAndDays( uk_day.startDate,  uk_day.endDate) %}
                    {% if taxyears is not empty %}
                      {{ taxyears[0] }}
                    {% endif %}
                </td>
                <td style="text-align: right">
                    {% set days = TaxYear.daysInPeriod( uk_day.startDate,  uk_day.endDate) %}
                    {% if days is not empty %}
                        {{ days[0] }}
                    {% endif %}
                </td>
                <td style="text-align: right">
                    {% if taxyears|length > 1 %}
                        {{ taxyears[1] }}
                        {% else %}
                        --
                    {% endif %}

                </td>
                <td style="text-align: right">
                    {% if days|length > 1 %}
                        {{ days[1] }}
                    {% else %}
                        --
                    {% endif %}
                </td>
                <td style="text-align: right">
                    <form method="post" action="{{ path('uk_days_delete', {'id': uk_day.id}) }}"
                          onsubmit="return confirm('Are you sure you want to delete this item?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ uk_day.id) }}">
                        <button class="btn btn-outline-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>


{% endblock %}

{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                'pageLength': 50,
                "order": [[0, 'desc', 1, 'desc']],
                "paging": false,
                "searching": false,
                "bInfo": false
            });
        });
    </script>
{% endblock datatable %}