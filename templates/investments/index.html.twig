{% extends 'base.html.twig' %}

{% block title %}Investments{% endblock %}

{% block body %}
    <h1 style="color: red">Investments</h1>

    <table class="table">
        <thead>
        <tr>
            <th>Asset Class</th>
            <th>Investment</th>
            <th>Investment Date</th>
            <th style="text-align: center">Â£</th>
            <th>EIS</th>
            <th style="text-align: right">MTM</th>
            <th>Sale Date</th>
            <th>Share Cert</th>
            <th>EIS Cert</th>
            <th>Other Docs</th>
            <th>EIS year</th>
            <th>Further comms</th>

        </tr>
        </thead>
        <tbody>

        {% for investment in investments %}
            {% set currentFXRate = 0 %}
            {% for fxRate in fxRates %}
                {% if investment.currency.fx == fxRate.fx %}
                    {% set currentFXRate = fxRate.currentFxRate %}
                {% endif %}
            {% endfor %}
            {% set investmentChildID = 'investment'~investment.id %}
            <tr>
                <td>{{investment.investmentCompany.assetClass }}</td>

                <td>
                    <button class="toggle-investment-child btn btn-outline-warning btn-sm"
                            data-investment-child-Id="{{ investmentChildID }}"><i class="fas fa-caret-down"></i>
                    </button>
                    {% if investment.investmentCompany is not null %}
                        <a href="{{ path('investments_edit', {'id': investment.id}) }}">{{ investment.investmentCompany.shareCompany }}</a>
                    {% else %}
                        <a href="{{ path('investments_edit', {'id': investment.id}) }}">--</a>
                    {% endif %}

                </td>
                <td data-sort="{{ investment.investmentDate|date('Y-m-d') }}">{{ investment.investmentDate ? investment.investmentDate|date('d-M-Y') : '' }}</td>

                <td style="text-align: right">
                    {% if investment.currency.fx == 'GBP' %}
                        {{ (investment.numberOfShares*investment.purchaseSharePrice)| number_format (0, '.') }}
                    {% else %}

                        <a title="{{ investment.currency.fx }} {{ (investment.numberOfShares*investment.purchaseSharePrice)| number_format (0, '.') }} ">*{{ (investment.initialInvestmentAmountGBP)| number_format (0, '.') }}</a>
                    {% endif %}
                </td>

                <td>
                    {% if investment.investmentEIS == 1 %}
                        <i class="fa fa-circle" style="color: green; text-align: right"></i>
                    {% else %}
                        <i class="fa fa-circle" style="color: red; text-align: right"></i>
                    {% endif %}


                </td>



                <td style="text-align: right">
                    {% if investment.currency.fx == 'GBP' %}
                        {{ (investment.numberOfShares*investment.investmentCompany.sharePrice)| number_format (0, '.') }}
                    {% else %}
                        {{ (investment.numberOfShares*investment.investmentCompany.sharePrice/currentFXRate )| number_format (0, '.') }}
                    {% endif %}
                </td>







                <td data-sort="{{ investment.currency.fx }}{{ investment.investmentSaleDate|date('Y-m-d') }}">{{ investment.investmentSaleDate ? investment.investmentSaleDate|date('d-M-Y') : '' }}</td>
                <td style="text-align: center">
                    {% if investment.shareCert is not empty %}
                        <a title="{{ investment.shareCert }}" target="_blank"
                           href="{{ path('investments_show',{id : investment.id, type: 'ShareCert'}) }}"><i
                                    class="fa fa-paperclip"></i></a>
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if investment.eisCert is not empty %}
                        <a title="{{ investment.eisCert }}" target="_blank"
                           href="{{ path('investments_show',{id : investment.id, type: 'EISCert'}) }}"><i
                                    class="fa fa-paperclip"></i></a>
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if investment.otherDocs is not empty %}
                        <a title="{{ investment.otherDocs }}" target="_blank"
                           href="{{ path('investments_show',{id : investment.id, type: 'OtherDocs'}) }}"><i
                                    class="fa fa-paperclip"></i></a>
                    {% endif %}
                </td>

                <td>
                    {% if investment.eISPurchaseYear1 is not empty %}
                        {{ investment.eISPurchaseYear1.year }}
                    {% endif %}
                    {% if investment.eISPurchaseYear2 is not empty %}
                        {{ investment.eISPurchaseYear2.year }}
                    {% endif %}
                </td>
                <td>

                    <a class="btn btn-success btn-sm mt-2"
                       href="{{ path('investment_future_comms_new', {'id': investment.investmentCompany.id}) }}">+</a>
                </td>
            </tr>

            <tr id="{{ investmentChildID }}" class="investmentsChildren">
                <td colspan="10">
                    <div>
                        {% for investmentFutureComms in investmentsFutureComms %}
                            {% if investmentFutureComms.marketData.id == investment.investmentCompany.id %}
                                <div>
                                    <div class="d-flex">
                                        <div><a target="_blank"
                                                href="{{ path('investment_future_comms_edit', {'id': investmentFutureComms.id}) }}"> {{ investmentFutureComms.date |date('d-M-Y') }}</a>
                                        </div>
                                        <div class="mx-2">
                                            {% if investmentFutureComms.attachment is not empty %}
                                                {% for attachment in investmentFutureComms.attachment %}
                                                    <a title="{{ attachment }}" target="_blank"
                                                       href="{{ path('investment_future_comms_edit',{id : investmentFutureComms.id}) }}"><i
                                                                class="fa fa-paperclip"></i></a>
                                                {% endfor %}
                                            {% endif %}

                                        </div>
                                        <div class="mx-2">{{ investmentFutureComms.comment }}</div>


                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a class="btn btn-success btn-sm mt-2" href="{{ path('investments_new') }}">New Investment</a>
{% endblock %}
{% block additionaljs %}
    <script>
        $('.toggle-investment-child').click(function () {
            var investment_Child_ID = $(this).attr("data-investment-Child-Id");
            $("#" + investment_Child_ID).toggle();
        })
    </script>
{% endblock additionaljs %}


{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                'pageLength': 50,
                "order": [[0, 'asc'] [1,'asc']],
                "paging": false,
                "searching": false,
                "bInfo": false
            });
        });
    </script>
{% endblock datatable %}