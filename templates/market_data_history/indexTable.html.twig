{% extends '../../base.html.twig' %}

{% block title %}Market Data: {{ heading }}{% endblock %}

{% block body %}
    <h1 style="color: red">Market Data: {{ heading }} </h1>
    <div class="row">
        <div class="col-3">
            {% if aggregated == "Yes" %}
                <a class="btn btn-success btn-sm" href="{{ path('market_data_history_new') }}">New</a>
            {% endif %}
            <a class="btn btn-outline-info btn-sm"
               href="{{ path('market_data_history_index',{subset:'All', security: 'All'}) }}">Calendar view</a>
            <a class="btn btn-danger btn-sm" href="{{ path('historic_market_data_delete_all') }}">Delete All</a><br>
            <a href="{{ asset('administration/attachments/FXRates/Template/Share_Prices_Upload_TemplateCSV.csv') }}">Template</a>
        </div>
        <div class="col-3">
            <a target="_blank" class="btn btn-outline-primary btn-sm"
               href="{{ path('market_data_history_index_table', {subset: 'All', security: 'All'}) }}">All</a></ul>
            <a target="_blank" class="btn btn-outline-primary btn-sm"
               href="{{ path('market_data_history_index_table', {subset: 'Active', security: 'All'}) }}">Active</a></ul>
            <a target="_blank" class="btn btn-outline-primary btn-sm"
               href="{{ path('market_data_history_index_table', {subset: 'Sold', security: 'All'}) }}">Sold</a></ul>
        </div>
    </div><br>
    <div class="row">

        {% for market_data in securities %}
            <div class="col-2">

                {% if aggregated=="Yes" %}
                    <h3>{{ market_data.shareCompany }}</h3>
                {% endif %}

                <a class="btn btn-outline-success btn-sm" target="_blank"
                   href="{{ path('market_data_history_new', { securitiesID: market_data.id} ) }}">New</a>

                <a class="btn btn-outline-primary btn-sm" target="_blank"
                   href="{{ path('security_prices_import', {security: market_data.id}) }}">Import
                    history</a>
                <br> <br>

                <table class="table table-responsive">
                    <thead>
                    <tr style="background-color: whitesmoke; border-bottom: 1px solid">
                        <th style="width: 80px; border-left: 1px dotted;border-right: 1px dotted">Date</th>

                        <th style="border-right: 1px dotted">Share Price</th>
                        <th style="border-right: 1px dotted"></th>
                    </tr>
                    </thead>

                    <tbody>
                    {% for market_data_history in market_data_histories %}
                        {% if market_data_history.security == market_data %}
                            <tr>
                                <td style=" text-align: right; border-left: 1px dotted; border-right: 1px dotted"
                                    data-sort="{{ market_data_history.date|date('Y-m-d') }}">
                                    <a target="_blank" href="{{ path('market_data_history_edit', {id: market_data_history.id}) }}">{{ market_data_history.date|date('d-M-y') }}</a>
                                </td>

                                <td style="border-right: 1px dotted; text-align: center">
                                    {{ market_data_history.marketPrice|number_format(2, '.', ',') }}
                                </td>
                                <td style="border-right: 1px dotted">
                                    <form method="post"
                                          action="{{ path('market_data_history_delete', {'id': market_data_history.id}) }}"
                                          onsubmit="return confirm('Are you sure you want to delete this item?');">
                                        <input type="hidden" name="_token"
                                               value="{{ csrf_token('delete' ~ market_data_history.id) }}">
                                        <button class="btn btn-danger btn-sm">
                                            <i style="color: white;" class="fa fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <br>
            <br>
            <br>
        {% endfor %}

    </div>
{% endblock %}

{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                'pageLength': 50,
                "order": [[0, 'desc'], [1, 'desc']],
                "paging": false,
                "searching": false,
                "bInfo": false
            });
        });
    </script>
{% endblock datatable %}