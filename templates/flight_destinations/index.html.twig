{% extends 'base.html.twig' %}

{% block title %}Flight Destinations{% endblock %}

{% block body %}
    <h1 style="color: red">Flight Destinations</h1>
    <b>Default
        dates:</b> {{ settings.flightStatsStartDate|date('d-M-y') }} - {{ settings.flightStatsStartDate|date_modify('+'~ settings.flightStatsDays~'days' )|date('d-M-y') }} ({{ settings.flightStatsDays }} days)
    <br>
    <a class="btn btn-outline-info btn-sm" href="{{ path('house_guests_index', {subset:'All'}) }}">House Guest</a>
    <a target="_blank" class="btn btn-outline-info btn-sm" href="{{ path('settings_edit', {id:'1'}) }}">Settings</a>
    <a target="_blank" class="btn btn-outline-info btn-sm" href="{{ path('airports_new') }}">Add Airport</a>
    <br>
    <table class="table table-responsive">
        <thead>
        <tr>
            <th>Group</th>
            <th>Departure</th>
            <th>Arrival</th>
            <th>Return<br>Leg</th>
            <th>Start</th>
            <th>End</th>
            <th>Admin Only</th>
            <th>Active</th>
            <th>Last Scraped</th>
            <th>Scrape</th>
            <th>Add</th>
            <th>Delete</th>
            <th>Edit</th>
        </tr>
        </thead>
        <tbody>
        {% for flight_destination in flight_destinations %}
            {% if flight_destination.groupingX is even %}
                <tr style="background-color: whitesmoke">
            {% else %}
                <tr>
            {% endif %}
            <td style="text-align: center">
                <b> {{ flight_destination.groupingX }}</b>
            </td>
            <td>
                {{ flight_destination.departureCity.city }} ({{ flight_destination.departureCity.airportCode }})
            </td>
            <td>
                {{ flight_destination.arrivalCity.city }} ({{ flight_destination.arrivalCity.airportCode }})
            </td>
            <td>
                {{ flight_destination.returnLeg }}
            </td>
            <td data-sort="{{ flight_destination.dateStart|date('Y-m-d') }}">{{ flight_destination.dateStart ? flight_destination.dateStart|date('d-M-y') : '' }}</td>
            <td data-sort="{{ flight_destination.dateEnd|date('Y-m-d') }}">{{ flight_destination.dateStart ? flight_destination.dateEnd|date('d-M-y') : '' }}
                {% if flight_destination.dateStart|date('Y-m-d') == settings.flightStatsStartDate|date('Y-m-d')
                    and flight_destination.dateEnd|date('Y-m-d') ==
                    (settings.flightStatsStartDate|date_modify('+'~ settings.flightStatsDays~'days' ))|date('Y-m-d') %}
                {% else %}
                    <a href="{{ path('flight_destinations_reset_dates', {id:flight_destination.id}) }}">
                        <i style="color: red" class="fa fa-rotate-left"></i></a>
                {% endif %}
            </td>
            <td style="text-align: center">
                {% if flight_destination.adminOnly ==1 %}
                    <a href="{{ path('flight_destinations_change_admin_status', {'id':flight_destination.id,'admin':'0'}) }}"><i
                                style="color: green" class="fa fa-hat-wizard"></i></a>
                {% else %}
                    <a href="{{ path('flight_destinations_change_admin_status', {'id':flight_destination.id,'admin':'1'}) }}"><i
                                style="color: red" class="fa fa-remove"></i></a>
                {% endif %}
            </td>
            <td style="text-align: center">
                {% if flight_destination.isActive ==1 %}
                    <a href="{{ path('flight_destinations_change_isactive_status', {'id':flight_destination.id, 'active':'0'}) }}"><i
                                style="color: green" class="fa fa-check"></i></a>
                {% else %}
                    <a href="{{ path('flight_destinations_change_isactive_status', {'id':flight_destination.id, 'active':'1'}) }}"><i
                                style="color: red" class="fa fa-remove"></i></a>
                {% endif %}
            </td>
            <td style="text-align: center">
                {% if flight_destination.lastScraped is not null %}
                    {{ flight_destination.lastScraped|date('d-M-y') }}
                {% endif %}
            </td>
            <td style="text-align: center">
                <a href="{{ path('house_guests_flight_price_scrape_one_destination', {id:flight_destination.id}) }}">
                    <i style="color: blue" class="fa fa-download"></i>
                </a>
            </td>
            <td>
                {% if flight_destination.returnLeg is null  %}
                    <a class="btn btn-outline-primary btn-sm" title="Copy as a return leg"
                       href="{{ path('flight_destinations_new_return', {id:flight_destination.id}) }}">
                        <i class="fa fa-copy"></i>
                        <i class="fa fa-repeat"></i>
                    </a>
                {% endif %}
            </td>
            <td>
                <form method="post"
                      action="{{ path('flight_destinations_delete', {'id': flight_destination.id}) }}">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ flight_destination.id) }}">
                    <button class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
            <td style="text-align: right">
                <a target="_blank" class="btn btn-outline-danger btn-sm"
                   href="{{ path('flight_destinations_edit', {'id': flight_destination.id}) }}">Edit</a>
            </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a class="btn btn-success btn-sm" href="{{ path('flight_destinations_new') }}">New</a>
{% endblock %}

{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                'pageLength': 100,
                "order": [[0, 'asc']],
                "paging": false,
                "searching": true,
                "bInfo": false
            });
        });
    </script>
{% endblock datatable %}
