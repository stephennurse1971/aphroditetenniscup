{% extends 'base.html.twig' %}
{% block title %}Users: Festive Message {% endblock %}
{% block body %}
    <h1><span class="text-danger">Festive Message</span></h1>

    <a class="btn btn-outline-danger btn-sm" href="{{ path('user_delete_festive_message') }}">Clear Festive Message</a>
    <table class="table">
        <thead>
        <tr>
            <th>Inc</th>
            <th>Date</th>
            <th>Name</th>
            <th>Company</th>

            <th>Admin</th>
            <th>Family</th>
            <th>Contact</th>
            <th>Guest</th>

            <th title="Home/Business">Address</th>
            <th>Mobile(s)</th>
            <th>Landlines</th>
            <th>Email(s)</th>
            <th>Birthday</th>
            <th>Notes</th>
            <th>Send message</th>
        </tr>
        </thead>

        <tbody>
        {% for user in users %}
            <tr>
                <td style="text-align: center" ; data-sort="{{ user.festiveMessage }}">
                    {% if user.festiveMessage == '1' %}
                        <a href="{{ path('user_edit_festive_message', {'id':user.id,  'active': '0'}) }}"><i
                                    class="fa fa-circle" style="color: green; text-align: right"></i></a>
                    {% else %}
                        <a href="{{ path('user_edit_festive_message', {'id':user.id,  'active': '1'}) }}"><i
                                    class="fa fa-circle" style="color: red; text-align: right"></i></a>
                    {% endif %}
                </td>

                <td>
                    {% if user.festiveMessageDate is not null %}
                        {{ user.festiveMessageDate|date('d-M-Y') }}
                    {% endif %}
                </td>
                <td>
                    {% if is_granted('ROLE_SUPER_ADMIN') or app.user.id==user.id %}
                        <b><a target="_blank" href="{{ path('user_edit', {'fullName': user.fullName}) }}">  {{ user.fullName }}</a></b>
                    {% else %}
                        <b><a target="_blank" href="{{ path('user_show', {'fullName': user.fullName}) }}">  {{ user.fullName }}</a></b>
                    {% endif %}
                </td>

                <td>{{ user.company }}</td>


                {% set role_flag1 = 0 %}
                {% for role in user.roles %}
                    {% if role == 'ROLE_SUPER_ADMIN' or role == 'ROLE_ADMIN' %}
                        {% set role_flag1 = 1 %}
                    {% endif %}
                {% endfor %}


                {# ------ Next radio button ROLE_ADMIN (1)--------------- -#}
                <td data-sort="{{ role_flag1 }}" style="text-align: center">
                    {% set role_flag1 = 0 %}
                    {% for role in user.roles %}
                        {% if role == 'ROLE_ADMIN' %}
                            {% set role_flag1 = 1 %}
                        {% endif %}
                    {% endfor %}
                    {% if role_flag1 == 1 %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: green; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_ADMIN", 'active': '1'}) }}"><i
                                        class="fa fa-circle" style="color: green; text-align: right"></i></a>
                        {% endif %}
                    {% else %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: red; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_ADMIN", 'active': '1'}) }}"><i
                                        class="fa fa-circle" style="color: red; text-align: right"></i></a>
                        {% endif %}
                    {% endif %}
                </td>



                {# ------ Next radio button ROLE_FAMILY (2)--------------- -#}
                {% set role_flag3 = 0 %}
                {% for role in user.roles %}
                    {% if role == 'ROLE_FAMILY' %}
                        {% set role_flag3 = 1 %}
                    {% endif %}
                {% endfor %}
                <td data-sort="{{ role_flag3 }}" style="text-align: center">
                    {% if role_flag3 == 1 %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: green; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_FAMILY", 'active': '0'}) }}"><i
                                        class="fa fa-circle" style="color: green; text-align: right"></i></a>
                        {% endif %}
                    {% else %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: red; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_FAMILY", 'active': '1'}) }}"><i
                                        class="fa fa-circle" style="color: red; text-align: right"></i></a>
                        {% endif %}
                    {% endif %}
                </td>


                {# ------ Next radio button ROLE_CONTACT (3)--------------- -#}
                {% set role_flag4 = 0 %}
                {% for role in user.roles %}
                    {% if role == 'ROLE_CONTACT' %}
                        {% set role_flag4 = 1 %}
                    {% endif %}
                {% endfor %}
                <td data-sort="{{ role_flag4 }}" style="text-align: center">
                    {% if role_flag4 == 1 %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: green; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_CONTACT", 'active': '0'}) }}"><i
                                        class="fa fa-circle" style="color: green; text-align: right"></i></a>
                        {% endif %}
                    {% else %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: red; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_CONTACT", 'active': '1'}) }}"><i
                                        class="fa fa-circle" style="color: red; text-align: right"></i></a>
                        {% endif %}
                    {% endif %}
                </td>


                {# ------ Next radio button ROLE_GUEST (4)--------------- -#}
                {% set role_flag5 = 0 %}
                {% for role in user.roles %}
                    {% if role == 'ROLE_GUEST' %}
                        {% set role_flag5 = 1 %}
                    {% endif %}
                {% endfor %}
                <td data-sort="{{ role_flag5 }}" style="text-align: center">
                    {% if role_flag5 == 1 %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: green; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_GUEST", 'active': '0'}) }}"><i
                                        class="fa fa-circle" style="color: green; text-align: right"></i></a>
                        {% endif %}
                    {% else %}
                        {% if app.user.id == user.id %}
                            <i class="fa fa-circle" style="color: red; text-align: right"></i>
                        {% else %}
                            <a href="{{ path('user_edit_button', {'id':user.id, 'role': "ROLE_GUEST", 'active': '1'}) }}"><i
                                        class="fa fa-circle" style="color: red; text-align: right"></i></a>
                        {% endif %}
                    {% endif %}
                </td>















                <td style="text-align: center">
                    {% if user.homeStreet is not empty %}
                        <i class="fa fa-home"
                           title="{{ user.homeStreet }} {{ user.homeCity }} {{ user.homePostalCode }}"></i>
                    {% endif %}

                    {% if user.homeStreet is not empty and user.businessStreet is not empty %} / {% endif %}

                    {% if user.businessStreet is not empty %}
                        <i class="fa fa-industry"
                           title="{{ user.businessStreet }} {{ user.businessCity }} {{ user.businessPostalCode }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% if user.mobile is not empty %}
                        <i class="fa fa-phone" title="{{ user.mobile }}"></i>
                    {% endif %}

                    {% if user.mobile is not empty and user.mobile2 is not empty %} /
                    {% endif %}
                    {% if user.mobile2 is not empty %}
                        <i class="fa fa-phone" title="{{ user.mobile2 }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% if user.businessPhone is not empty %}
                        <i class="fa fa-phone" title="{{ user.homePhone }}"></i>
                    {% endif %}

                    {% if user.homePhone is not empty and user.businessPhone is not empty %} /
                    {% endif %}
                    {% if user.homePhone is not empty %}
                        <i class="fa fa-phone" title="{{ user.homePhone }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% set instring = '@no_email.com' in user.email %}
                    {% if user.email is not empty and instring != 1 %}
                        <a title="{{ user.email }}" href="mailto:{{ user.email }}">
                            <i class="fa fa-envelope"></i>
                        </a>
                    {% else %}
                        <a title="{{ user.email }}" href="">N/A</a>
                    {% endif %}

                    {% if user.email2 is not empty %}
                        <a title="{{ user.email2 }}" href="mailto:{{ user.email2 }}">
                            <i class="fa fa-envelope-open-o"></i>
                        </a>
                    {% endif %}

                    {% if user.email3 is not empty %} /
                        <a title="{{ user.email3 }}" href="mailto:{{ user.email3 }}">
                            <i class="fa fa-envelope-open-o"></i>
                        </a>
                    {% endif %}
                </td>
                <td style="text-align: center" ; data-sort="{{ user.birthday|date('m-d') }}">
                    {% if user.birthday is not empty %}
                        {{ user.birthday |date('d-M-Y') }}
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if user.notes is not empty %}
                        <i class="fa fa-info-circle" title="{{ user.notes }}"></i>
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if user.festiveMessage == 1 and user.email is not null and user.festiveMessageDate is empty %}
                        <a class="btn btn-success btn-sm" href="{{ path('user_festive_email', {'userid':user.id}) }}">Send
                            Festive eMail</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}


        </tbody>
    </table>

    <br>
    <br>
{% endblock %}
{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                "pageLength": 100,
                "order": [[0, 'desc'],[3, 'asc'], [2, 'asc']],
                "paging": false,
                "searching": true,
                "bInfo": true
            });
        });
    </script>
{% endblock datatable %}