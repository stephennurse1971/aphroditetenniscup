{% extends 'base.html.twig' %}
{% block title %}Recruiters: {{ role }} {% endblock %}
{% block body %}
    <h1><span class="text-danger">Headhunters</span></h1>

    {% if is_granted('ROLE_SUPER_ADMIN') %}
        <a class="btn btn-danger btn-sm" href="{{ path('/user/delete_all_non_admin') }}">Delete All Users (excl
            Admin)</a>
        <a class="btn btn-danger btn-sm" href="{{ path('/user/delete_all_AX') }}">Delete AX Users (excl Admin)</a>
        <a class="btn btn-danger btn-sm" href="{{ path('/user/delete_all_Personal') }}">Delete Personal Users (excl
            Admin) </a>
        <a class="btn btn-success btn-sm" href="{{ path('user_export', {Subset: 'Recruiters'}) }}">Export Recruiters to
            CSV</a>
    {% endif %}

    <table class="table">
        <thead>
        <tr>
            <th>Salutation</th>
            <th>Name</th>
            <th>Recruiting Company</th>
            <th>Hiring Company</th>
            <th title="Home/Business">Address</th>
            <th>Mobile(s)</th>
            <th>Landlines</th>
            <th>Email(s)</th>
            <th>LinkedIN</th>
            <th>www</th>
            <th>Country</th>
            <th>Areas</th>
            <th>Areas (List)</th>
            <th style="width: 150px">Notes</th>
            <th>Invite email</th>
            <th>Date</th>
            <th>VCF</th>
            <th>Opportunity</th>
            {% if is_granted('ROLE_ADMIN') %}
                <th style="color: red;">Plain Password</th>
                <th style="color: red;">#</th>
            {% endif %}
        </tr>
        </thead>

        <tbody>
        {% for user in users %}

            <tr>
                <td>{{ user.salutation }}</td>
                <td>
                    {% if is_granted('ROLE_SUPER_ADMIN') or app.user.id==user.id %}
                        <b><a target="_blank"
                              href="{{ path('user_edit', {'id': user.id}) }}">  {{ user.fullName }}</a></b>
                    {% else %}
                        <b><a target="_blank"
                              href="{{ path('user_show', {'id': user.id}) }}">  {{ user.fullName }}</a></b>
                    {% endif %}
                </td>

                <td>{{ user.company }}</td>
                <td>
                    {% for prospect_employer in prospect_employers %}
                        {% if prospect_employer.recruiter.id == user.id %}
                            <a target="_blank" href="{{ path('prospect_employer_edit', {'id': prospect_employer.id}) }}">{{ prospect_employer.employer }}</a>;
                        {% endif %}
                    {% endfor %}
                </td>

                <td style="text-align: center">
                    {% if user.homeStreet is not empty %}
                        <i class="fa fa-home"
                           title="{{ user.homeStreet }} {{ user.homeCity }} {{ user.homePostalCode }}"></i>
                    {% endif %}

                    {% if user.homeStreet is not empty and user.businessStreet is not empty %} / {% endif %}

                    {% if user.businessStreet is not empty %}
                        <i class="fa fa-industry"
                           title="{{ user.businessStreet }} {{ user.businessCity }} {{ user.businessPostalCode }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% if user.mobile is not empty %}
                        <i class="fa fa-phone" title="{{ user.mobile }}"></i>
                    {% endif %}

                    {% if user.mobile2 is not empty %} /
                        <i class="fa fa-phone" title="{{ user.mobile2 }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% if user.businessPhone is not empty %}
                        <i class="fa fa-phone" title="{{ user.businessPhone }}"></i>
                    {% endif %}

                    {% if user.homePhone is not empty %} /
                        <i class="fa fa-phone" title="{{ user.homePhone }}"></i>
                    {% endif %}
                </td>

                <td style="text-align: center">
                    {% if user.email is not empty %}
                        <a title="{{ user.email }}" href="mailto:{{ user.email }}">
                            <i class="fa fa-envelope-open-o"></i>
                        </a>
                    {% endif %}

                    {% if user.email2 is not empty %}
                        <a title="{{ user.email2 }}" href="mailto:{{ user.email2 }}">
                            <i class="fa fa-envelope-open-o"></i>
                        </a>
                    {% endif %}

                    {% if user.email3 is not empty %} /
                        <a title="{{ user.email3 }}" href="mailto:{{ user.email3 }}">
                            <i class="fa fa-envelope-open-o"></i>
                        </a>
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if user.linkedIn is not empty %}
                        <a target="_blank" title="{{ user.linkedIn }}" href="{{ user.linkedIn }}">
                            <i class="fa fa-linkedin"></i>
                        </a>
                    {% endif %}
                </td>
                <td style="text-align: center">
                    {% if user.webPage is not empty %}
                        {% if user.webPage starts with 'http' %}
                            {% set web = user.webPage %}
                        {% else %}
                            {% set web = 'https://'~user.webPage %}
                        {% endif %}
                        <a target="_blank" title="{{ user.webPage }}" href="{{ web }}">
                            <i class="fa fa-globe"></i>
                        </a>
                    {% endif %}
                </td>

                <td>{{ user.businessCountry }}</td>
                <td>{{ user.recruitingArea }}</td>
                <td>
                    {% for area in user.recruitingAreaList %}
                        {{ area }},
                    {% endfor %}
                </td>
                <td>{{ user.notes }}</td>
                <td style="width: 200px">
                    <a class="btn btn-success btn-sm d-inline"
                       href="{{ path('recruiter_intro', {'authorId':app.user.id,
                           'recruiterId': user.id, 'recruiterCountry': user.businessCountry, 'editable':'editable'}) }}">Editable</a>
                    <a class="btn btn-primary btn-sm" href="{{ path('recruiter_intro', {'authorId':app.user.id,
                        'recruiterId': user.id, 'recruiterCountry': user.businessCountry, 'editable':'standard' }) }}">Standard</a>
                    <br>
                </td>
                <td style="width: 200px">
                    {% for recruiterEmail in recruiterEmails %}
                        {% if recruiterEmail.Author == app.user.email and recruiterEmail.sendToFullName == user.fullName %}
                            <a target="_blank"
                               href="{{ path('recruiter_emails_show',{'id':recruiterEmail.id}) }}">{{ recruiterEmail.sendDate|date('d-M-Y h:i') }}</a>

                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <a class="btn btn-outline-info btn-sm"
                       href="{{ path('create_vcard_user',{'userid': user.id}) }}"><i
                                style="font-size: 15px; color: blue" class="fas fa-address-card"></i></a>
                </td>
                <td>
                    <a target="_blank" class="btn btn-outline-success btn-sm"
                       href="{{ path('prospect_employer_new',{'applicantid': app.user.id, 'recruiterid':user.id}) }}">Opening</a>
                </td>

                {% if is_granted('ROLE_SUPER_ADMIN') %}
                    <td>{{ user.plainPassword }}</td>
                    <td>
                        <form class="d-inline" method="post" action="{{ path('user_delete', {'id': user.id}) }}"
                              onsubmit="return confirm('Are you sure you want to delete this item?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                            <button class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></button>
                        </form>
                    </td>
                {% endif %}

            </tr>
        {% endfor %}


        </tbody>
    </table>

    {% if is_granted('ROLE_SUPER_ADMIN') %}
        <a class="btn btn-success mt-3" href="{{ path('user_new') }}">New user</a>
        <a class="btn btn-primary mt-3" href="{{ path('userImport',{ source: 'Outlook'}) }}">Import from Outlook</a>
        <a class="btn btn-secondary mt-3" href="{{ path('userImport',{ source: 'Grapevine'}) }}">Import from Grapevine
            (Recruiters)</a>
        <a href="https://www.datagrapevine.com/recruitment/welcome">Grapevine</a>
    {% endif %}
    <br>
    <br>
{% endblock %}
{% block datatable %}
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                "pageLength": 100,
                "order": [[14, 'desc'], [0, 'asc']],
                "paging": false,
                "searching": true,
                "bInfo": true
            });
        });
    </script>
{% endblock datatable %}